<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chaos Gacha — Enhanced</title>
  <style>
    :root{
      /* refreshed, livelier palette */
      --bg:#232425; /* gray-ish */
      --bg-alt:#232425; /* same as gray-ish */
      --panel:#082630; /* tealish panel */
      --panel-alt:#042026; /* darker panel shade */
      --muted:#c5d2d4; /* soft cyan for muted text */
      --accent: #3f717a; /* bright cyan accent */
      /* category color tokens (rgb for translucent use and hex for solid use) */
      --cat-skills: #7dd3fc;
      --cat-skills-rgb: 125,211,252;
      --cat-traits: #a78bfa;
      --cat-traits-rgb: 167,139,250;
      --cat-items: #f59e0b;
      --cat-items-rgb: 245,158,11;
      --cat-powers: #34d399;
      --cat-powers-rgb: 52,211,153;
      --glass: rgba(255,255,255,0.04);
      --radius:12px;
      --card-w:260px;
      --card-h:140px;
    }
    *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#e6edf3;background:linear-gradient(180deg,var(--bg),var(--bg-alt));}

    /* center the app in the viewport */
    html, body { display: block; }
    body { display: flex; align-items: center; justify-content: center; min-height: 100vh; }

    .app{
      /* ensure app does not force full viewport height so body centering works */
      min-height: auto;
      width: 100%;
      max-width: 1100px;
      display:grid;
      grid-template-columns:260px 1fr;
      gap:28px;
      padding:28px;
      align-items:start;
    }

    /* SIDE */
    .side{
      background:linear-gradient(180deg, rgba(6,182,212,0.04), rgba(2,32,36,0.02));
      border-radius:var(--radius);
      padding:18px;
      border:1px solid rgba(255,255,255,0.03);
      min-height:220px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }
    .logo{font-weight:800;font-size:18px;color:var(--accent);letter-spacing:0.6px}
    .menu{display:flex;flex-direction:column;gap:8px}
    .menu button{
      background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03);padding:10px;border-radius:10px;text-align:left;cursor:pointer;font-weight:600;transition:all .18s;display:flex;justify-content:space-between;align-items:center;position:relative;overflow:hidden;
    }
    /* colored accent bar on the left of each button */
    .menu button::before{content:'';position:absolute;left:0;top:6px;bottom:6px;width:6px;border-radius:8px;transition:all .18s;opacity:0.95}
    .menu button[data-cat="skills"]::before{background:var(--cat-skills)}
    .menu button[data-cat="traits"]::before{background:var(--cat-traits)}
    .menu button[data-cat="items"]::before{background:var(--cat-items)}
    .menu button[data-cat="powers"]::before{background:var(--cat-powers)}

    /* hover and active visuals — use subtle tinted backgrounds per category when active */
    .menu button:hover{transform:translateX(2px)}
    .menu button.active{transform:translateX(3px);color:#fff;border-color:rgba(255,255,255,0.06)}
    .menu button.active[data-cat="skills"]{background:linear-gradient(90deg, rgba(var(--cat-skills-rgb),0.08), rgba(255,255,255,0.01))}
    .menu button.active[data-cat="traits"]{background:linear-gradient(90deg, rgba(var(--cat-traits-rgb),0.08), rgba(255,255,255,0.01))}
    .menu button.active[data-cat="items"]{background:linear-gradient(90deg, rgba(var(--cat-items-rgb),0.08), rgba(255,255,255,0.01))}
    .menu button.active[data-cat="powers"]{background:linear-gradient(90deg, rgba(var(--cat-powers-rgb),0.08), rgba(255,255,255,0.01))}

    /* slightly widen the accent on hover for affordance */
    .menu button:hover::before{width:9px}

    .probabilities{margin-top:8px;background:var(--glass);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-size:13px;color:var(--muted)}
    .prob-row{display:flex;justify-content:space-between;margin:4px 0}

    /* MAIN */
    .main{display:flex;flex-direction:column;gap:18px}
  .top-row{display:flex;gap:18px;align-items:center}

    .card-wrap{width:var(--card-w);height:var(--card-h);perspective:1000px;position:relative}
    .gacha-card{
  width:100%;height:100%;border-radius:12px;background:linear-gradient(180deg,var(--panel),var(--panel-alt));border:2px solid rgba(255,255,255,0.04);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none;position:relative;overflow:hidden;box-shadow:0 10px 40px rgba(2,32,36,0.55);
      transform-style:preserve-3d;transition:transform .9s cubic-bezier(.2,.9,.3,1), box-shadow .25s;
    }
    .gacha-card.rolling{transform:rotateY(180deg) scale(1.02);}

    .gacha-front,.gacha-back{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;backface-visibility:hidden;padding:12px}
    .gacha-back{transform:rotateY(180deg);}

    .gacha-title{font-weight:800;color:var(--accent);letter-spacing:0.6px}
    .gacha-sub{font-size:13px;color:var(--muted);margin-top:6px}

    .rarity-badge{position:absolute;top:10px;left:10px;padding:6px 9px;border-radius:999px;font-weight:700;font-size:12px;color:#0b0c10;background:linear-gradient(90deg,#fff, #eee);opacity:0.95}

    /* Rarity colors */
  .rarity-common{--r:#95a5a6} /* soft steel */
  .rarity-rare{--r:#38bdf8} /* sky blue */
  .rarity-ultra-rare{--r:#7c5cff} /* vivid purple */
  .rarity-legendary{--r:#f59e0b} /* warm gold */
  .rarity-mythical{--r:#ff66b2} /* bright pink */
  .rarity-divine{--r:#ff6b5b} /* coral */
  .rarity-primordial{--r:#00d38a} /* neon green */
  .rarity-transcendental{--r:#06b6d4} /* cyan (accent) */
  .rarity-limitless{--r:#ff4db8} /* magenta */
  .rarity-unbounded{--r:#ffd166} /* sunny yellow */
  .rarity-garbage{--r:#7f8a8c} /* muted gray */

    .gacha-card .glow{position:absolute;inset:-20%;filter:blur(28px);opacity:0;transition:opacity .25s}
    .gacha-card.show-glow .glow{opacity:0.9}

    .gacha-card .name{font-weight:800;font-size:16px}
    .gacha-card .type{font-size:12px;color:var(--muted);margin-top:6px}

    .controls{display:flex;flex-direction:column;gap:8px;align-items:center}
  .btn{padding:10px 18px;border-radius:10px;border:none;background:var(--accent);color:#052026;font-weight:800;cursor:pointer;letter-spacing:0.6px;box-shadow:0 8px 24px rgba(6,182,212,0.12)}
    .btn:disabled{opacity:.5;cursor:default}

  .btn-muted{background:#0f2b33;color:#d8f6fb;padding:8px 12px;font-weight:700}
  .btn-dark{background:#072024;color:#dff7fb;padding:8px 12px;font-weight:700}

    .info{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);min-height:120px}

  /* history UI */
  .history{margin-top:12px;background:rgba(255,255,255,0.01);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  .history h4{margin:0 0 8px 0;color:var(--accent);font-weight:800}
  .history-list{display:flex;gap:8px;flex-wrap:wrap}
  .history-item{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);min-width:140px;font-size:13px}

    /* small screen */
    @media (max-width:900px){
      .app{grid-template-columns:1fr;align-items:center;padding:14px}
      .side{order:2;width:100%}
      .top-row{flex-direction:column;align-items:center}
    }

    /* particles canvas overlay */
    #fx-canvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:9999}

    /* tiny sparkle */
    .spark{position:absolute; width:6px;height:6px;border-radius:50%;opacity:0;transform:translate(-50%,-50%);pointer-events:none}

  </style>
</head>
<body>
  <div class="app">
    <aside class="side" aria-label="menu">
      <div class="logo">My GACHA — lol</div>
      <div class="menu" role="tablist" aria-orientation="vertical">
        <button id="tab-skills" data-cat="skills" class="active">Skills <span style="opacity:.6;font-weight:600">(skills)</span></button>
        <button id="tab-traits" data-cat="traits">Traits</button>
        <button id="tab-items" data-cat="items">Items</button>
        <button id="tab-powers" data-cat="powers">Powers</button>
      </div>
      <div class="probabilities" id="probabilities" aria-live="polite"></div>
      <small style="color:var(--muted);margin-top:8px;display:block">Tip: Not_Incide is a lil gay.</small>
    </aside>

    <main class="main">
      <div class="top-row">
        <div class="card-wrap">
          <div id="gachaCard" class="gacha-card" role="button" aria-pressed="false" tabindex="0">
            <div class="gacha-front">
              <div class="rarity-badge" id="rarityBadge" style="display:none">Common</div>
              <div class="name">Click to roll</div>
              <div class="type">Category: skills</div>
              <div class="glow" id="glowEl"></div>
            </div>
            <div class="gacha-back">
              <div style="font-weight:800;color:var(--accent)">Result</div>
              <div id="backDesc" style="font-size:13px;color:var(--muted);margin-top:8px;max-width:240px;text-align:center"></div>
            </div>
          </div>
        </div>

        <div class="controls">
          <button id="rollButton" class="btn">🎲 Roll</button>
          <label style="font-size:13px;color:var(--muted)">Showing: <strong id="currentCategoryLabel">skills</strong></label>
          <div style="margin-top:6px">
            <button id="copyBtn" class="btn" style="background:#334155;color:#fff;padding:8px 12px;font-weight:700">Copy result</button>
          </div>
          <div style="margin-top:8px">
            <button id="helpBtn" class="btn" style="background:#0b1220;color:#fff;padding:8px 12px;font-weight:700">Help</button>
          </div>
        </div>

        <canvas id="fx-canvas" aria-hidden="true"></canvas>
      </div>

      <section class="info" id="infoBox" aria-live="polite">
        <div style="font-weight:800;color:var(--accent)">Result will appear here</div>
        <div id="infoContent" style="margin-top:8px;color:var(--muted)">Press <strong>Roll</strong> to spin the gacha. High rarities trigger particle effects and a small audio cue.</div>
          <div class="history" aria-live="polite">
            <h4>History (last 5)</h4>
            <div class="history-list" id="historyList">
              <!-- history items injected here -->
            </div>
          </div>
      </section>

      <!-- Help modal -->
      <div id="helpModal" aria-hidden="true" style="display:none">
        <div id="helpOverlay" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:10000"></div>
        <div id="helpContent" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--panel);color:#fff;padding:18px;border-radius:12px;max-width:900px;width:90%;max-height:80vh;overflow:auto;z-index:10001;border:1px solid rgba(255,255,255,0.04)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <strong style="color:var(--accent);font-weight:800">Help & Options</strong>
            <button id="helpClose" style="background:transparent;border:none;color:var(--muted);cursor:pointer">✕</button>
          </div>
          <div style="margin-bottom:12px;color:var(--muted)">Options:</div>
          <div style="display:flex;gap:8px;margin-bottom:12px">
            <button id="showAllBtn" class="btn" style="background:#334155;color:#fff;padding:8px 10px;font-weight:700">Show every category</button>
            <button id="copyAllBtn" class="btn" style="background:#2d3748;color:#fff;padding:8px 10px;font-weight:700">Copy all names</button>
          </div>
          <div id="helpResults" style="color:var(--muted)"></div>
        </div>
      </div>

    </main>
  </div>

  <script>
    // --- CONFIG ---
    const rarityChances = {
      'Common': 35,
      'Garbage': 10,
      'Rare': 18,
      'Ultra Rare': 6,
      'Legendary': 2,
      'Mythical': 1,
      'Divine': 0.5,
      'Primordial': 0.3,
      'Transcendental': 0.15,
      'Limitless': 0.08,
      'Unbounded': 0.02,
    };

    const rarityOrder = ['Unbounded','Limitless','Transcendental','Primordial','Divine','Mythical','Legendary','Ultra Rare','Rare','Common','Garbage'];

    // raw data (you pasted a large db) -> we'll normalize on load so the original entries don't need editing
    const rawData = {
      skills: [
    { name: "Sharingan", type: "Skill", rarity: "Legendary", description: "Eye that copies and anticipates movements." },
    { name: "Mangekyō Sharingan", type: "Skill", rarity: "Mythical", description: "Extremely powerful ocular techniques." },
    { name: "Eternal Mangekyō", type: "Skill", rarity: "Divine", description: "Eternal version without ocular weaknesses." },
    { name: "Rinnegan", type: "Skill", rarity: "Divine", description: "Master paths, life, and death." },
    { name: "Byakugan", type: "Skill", rarity: "Ultra Rare", description: "360° vision and chakra detection." },
    { name: "Tenseigan", type: "Skill", rarity: "Mythical", description: "Celestial eye with gravitational control." },
    { name: "Susanoo", type: "Skill", rarity: "Mythical", description: "Imposing defensive/offensive ethereal avatar." },
    { name: "Amaterasu", type: "Skill", rarity: "Legendary", description: "Black flames that consume everything." },
    { name: "Kamui", type: "Skill", rarity: "Ultra Rare", description: "Spatial distortion and dimensional teleportation." },
    { name: "Tsukuyomi", type: "Skill", rarity: "Legendary", description: "Absolute-effect temporal illusion." },
    { name: "Six Paths Power", type: "Skill", rarity: "Divine", description: "Set of transcendental abilities." },
    { name: "Domain Expansion: Infinite Void", type: "Skill", rarity: "Divine", description: "Space that paralyzes enemy minds." },
    { name: "Domain Expansion: Malevolent Shrine", type: "Skill", rarity: "Mythical", description: "Offensive domain with absolute range." },
    { name: "Hollow Purple (Cursed)", type: "Skill", rarity: "Legendary", description: "Purgatory technique that obliterates matter." },
    { name: "Reverse Cursed Technique", type: "Skill", rarity: "Ultra Rare", description: "Healing/inverse cursed energy transformation." },
    { name: "Cursed Speech", type: "Skill", rarity: "Rare", description: "Words that inflict or force actions." },
    { name: "Cursed Energy Control", type: "Skill", rarity: "Common", description: "Foundation for shaping cursed energy." },
    { name: "Domain Amplification", type: "Skill", rarity: "Rare", description: "Increases domain power and range." },
    { name: "Black Flash", type: "Skill", rarity: "Legendary", description: "Impact with temporal synchronization extra force." },
    { name: "Rasengan", type: "Skill", rarity: "Rare", description: "Highly concentrated spinning chakra ball." },
    { name: "Chidori", type: "Skill", rarity: "Rare", description: "Concentrated lethal lightning attack." },
    { name: "Sage Mode", type: "Skill", rarity: "Ultra Rare", description: "Balance between natural energy and chakra." },
    { name: "Nine-Tails Chakra Mode", type: "Skill", rarity: "Mythical", description: "Massive reservoir of beastly chakra." },
    { name: "Shunpo", type: "Skill", rarity: "Ultra Rare", description: "Near-instantaneous movement flash." },
    { name: "Breathing Style: Water", type: "Skill", rarity: "Rare", description: "Fluid cuts and water techniques." },
    { name: "Breathing Style: Thunder", type: "Skill", rarity: "Rare", description: "Electrical attacks with extreme speed." },
    { name: "Breathing Style: Flame", type: "Skill", rarity: "Rare", description: "Fire control and offensive projection." },
    { name: "Spirit Energy Control", type: "Skill", rarity: "Rare", description: "Manipulate spiritual energy in combat." },
    { name: "Healing Hands", type: "Skill", rarity: "Common", description: "Basic healing of minor wounds." },
    { name: "Cursed Technique: Projection", type: "Skill", rarity: "Ultra Rare", description: "Project techniques from objects or sand." },
    { name: "Domain: Binding Field", type: "Skill", rarity: "Legendary", description: "Domain that imposes conditions on enemies." },
    { name: "Beast Instinct", type: "Skill", rarity: "Rare", description: "Enhanced reflexes and animal intuition." },
    { name: "Nen: Enhancement", type: "Skill", rarity: "Rare", description: "Enhances physical attributes via nen." },
    { name: "Nen: Manipulation", type: "Skill", rarity: "Ultra Rare", description: "Manipulate beings or objects with nen." },
    { name: "Nen: Conjuration", type: "Skill", rarity: "Rare", description: "Create tangible objects with nen." },
    { name: "Nen: Transmutation", type: "Skill", rarity: "Ultra Rare", description: "Convert nen into unique properties." },
    { name: "Instant Transmission", type: "Skill", rarity: "Ultra Rare", description: "Immediate teleportation to visualized target." },
    { name: "Time Skip Reflex", type: "Skill", rarity: "Mythical", description: "Perception that skips fractions of time." },
    { name: "Reality Perception", type: "Skill", rarity: "Divine", description: "See and manipulate real-world rules." },
    { name: "Energy Sensing", type: "Skill", rarity: "Common", description: "Detect nearby energy flows." },
    { name: "Weapon Mastery: Katana", type: "Skill", rarity: "Rare", description: "Advanced katana cutting mastery." },
    { name: "Puppet Control", type: "Skill", rarity: "Rare", description: "Manipulate puppets or others' bodies." },
    { name: "Cursed Technique: Blood Manipulation", type: "Skill", rarity: "Ultra Rare", description: "Use own blood as weapon or seal." },
    { name: "Haki: Observation", type: "Skill", rarity: "Ultra Rare", description: "See subtle movements and precognition (from One Piece)." },
    { name: "Haki: Armament", type: "Skill", rarity: "Rare", description: "Hardening and projection of will (from One Piece)." },
    { name: "Haki: Conqueror", type: "Skill", rarity: "Legendary", description: "Overwhelm wills and assert dominance (from One Piece)." },
    { name: "Bankai", type: "Skill", rarity: "Legendary", description: "Final devastating form of a Zanpakutō (from Bleach)." },
    { name: "Domain: Hollow Realm", type: "Skill", rarity: "Mythical", description: "A domain that distorts hollows and souls." }
  ],

  traits: [
    { name: "Saiyan Bloodline", type: "Trait", rarity: "Legendary", description: "Gain strength after each defeat." },
    { name: "Quirk Affinity", type: "Trait", rarity: "Rare", description: "Higher compatibility with quirks." },
    { name: "Cursed Vessel", type: "Trait", rarity: "Ultra Rare", description: "Attract and contain cursed energy." },
    { name: "Regenerator", type: "Trait", rarity: "Rare", description: "Accelerated tissue regeneration." },
    { name: "Berserker Rage", type: "Trait", rarity: "Ultra Rare", description: "Gain strength when enraged." },
    { name: "Glass Cannon", type: "Trait", rarity: "Common", description: "High damage, low defense." },
    { name: "Tank Body", type: "Trait", rarity: "Rare", description: "Extremely high physical resistance." },
    { name: "Genius Strategist", type: "Trait", rarity: "Rare", description: "Plan battles with precision." },
    { name: "Lucky Streak", type: "Trait", rarity: "Common", description: "Small odds always in favor." },
    { name: "Iron Will", type: "Trait", rarity: "Rare", description: "Easily resist mental effects." },
    { name: "Spirit-Bound", type: "Trait", rarity: "Mythical", description: "Stable connection with spiritual entities." },
    { name: "Shadow Kin", type: "Trait", rarity: "Ultra Rare", description: "Superior affinity with shadows." },
    { name: "Divine Heritage", type: "Trait", rarity: "Divine", description: "Direct link to celestial forces." },
    { name: "Beast Instinct", type: "Trait", rarity: "Rare", description: "Superhuman senses and instincts." },
    { name: "Veteran Fighter", type: "Trait", rarity: "Common", description: "Experience grants tactical advantage." },
    { name: "Hybrid Physiology", type: "Trait", rarity: "Rare", description: "Racial mix with unique abilities." },
    { name: "Curse Mark", type: "Trait", rarity: "Ultra Rare", description: "Mark that releases great dark power." },
    { name: "Master Tactician", type: "Trait", rarity: "Legendary", description: "Natural strategist in any field." },
    { name: "Empathic Link", type: "Trait", rarity: "Rare", description: "Feel others' emotions intensely." },
    { name: "Cold-Hearted", type: "Trait", rarity: "Common", description: "Keep a cool head always." },
    { name: "Night Vision", type: "Trait", rarity: "Common", description: "Enhanced vision in darkness." },
    { name: "Flight Adaptation", type: "Trait", rarity: "Rare", description: "Body adapted for sustained flight." },
    { name: "Mana Affinity", type: "Trait", rarity: "Rare", description: "Magic more efficient and powerful." },
    { name: "Weight of Fate", type: "Trait", rarity: "Mythical", description: "Accompanied by transcendental events." },
    { name: "Temporal Reflex", type: "Trait", rarity: "Ultra Rare", description: "React before events occur." },
    { name: "Noble Phantasm Resonance", type: "Trait", rarity: "Legendary", description: "Higher affinity with legendary weapons." },
    { name: "Poison Resistance", type: "Trait", rarity: "Common", description: "Withstand toxins more easily." },
    { name: "Iron Constitution", type: "Trait", rarity: "Rare", description: "Resist extreme conditions." },
    { name: "Soul Anchor", type: "Trait", rarity: "Mythical", description: "Existence not easily erased." },
    { name: "Echo Location", type: "Trait", rarity: "Common", description: "Highly precise orientation via sounds." },
    { name: "Adaptive Evolution", type: "Trait", rarity: "Rare", description: "Body adapts to threats." },
    { name: "Mana Well", type: "Trait", rarity: "Legendary", description: "Huge internal reservoir of magic." },
    { name: "Memory Keeper", type: "Trait", rarity: "Rare", description: "Perfect recollection of past events." },
    { name: "Chosen Lineage", type: "Trait", rarity: "Mythical", description: "Predestined for a great role." },
    { name: "Alchemical Touch", type: "Trait", rarity: "Ultra Rare", description: "Transform materials by touch." },
    { name: "Stealth Master", type: "Trait", rarity: "Rare", description: "Extreme ability to remain unseen." },
    { name: "Curse Reversal", type: "Trait", rarity: "Legendary", description: "Invert curses to your favor." },
    { name: "Giant Blood", type: "Trait", rarity: "Ultra Rare", description: "Superhuman size and strength." },
    { name: "Soul Eater", type: "Trait", rarity: "Mythical", description: "Absorb life energy from defeated." },
    { name: "Runic Tattoo", type: "Trait", rarity: "Rare", description: "Marks that enhance spells." },
    { name: "Bound Servant", type: "Trait", rarity: "Rare", description: "Allied spirit obeys your orders." },
    { name: "Eternal Youth", type: "Trait", rarity: "Legendary", description: "Ages extremely slowly." },
    { name: "Cosmic Awareness", type: "Trait", rarity: "Divine", description: "Perceive global cosmic patterns." },
    { name: "Otaku Knowledge", type: "Trait", rarity: "Common", description: "Intense anime knowledge and references." }
  ],

  items: [
    { name: "Excalibur", type: "Item", rarity: "Divine", description: "Sacred sword of overwhelming power." },
    { name: "Enuma Elish (Ea)", type: "Item", rarity: "Transcendental", description: "Noble Phantasm that remakes reality." },
    { name: "Gate of Babylon", type: "Item", rarity: "Mythical", description: "Infinite arsenal of legendary treasures." },
    { name: "Caliburn", type: "Item", rarity: "Legendary", description: "Precursor to Excalibur, pure blade." },
    { name: "Avalon (Noble Relic)", type: "Item", rarity: "Mythical", description: "Regenerative protection and eternal shield." },
    { name: "Death Note", type: "Item", rarity: "Legendary", description: "Write a name, the person dies." },
    { name: "Tessaiga", type: "Item", rarity: "Legendary", description: "Demonic sword with devastating techniques." },
    { name: "Nichirin Blade", type: "Item", rarity: "Ultra Rare", description: "Katana forged to hunt demons." },
    { name: "Kusanagi-no-Tsurugi", type: "Item", rarity: "Legendary", description: "Mythical sword of ancient Japan." },
    { name: "Ruyi Jingu Bang", type: "Item", rarity: "Legendary", description: "Extendable staff with colossal power." },
    { name: "Zanpakutō: Bankai", type: "Item", rarity: "Ultra Rare", description: "Final form of a soul-sword." },
    { name: "Black Grimoire", type: "Item", rarity: "Mythical", description: "Book with forbidden dark spells." },
    { name: "Holy Grail", type: "Item", rarity: "Divine", description: "Can grant wishes to possessor." },
    { name: "Command Seal", type: "Item", rarity: "Legendary", description: "Absolute order to a summoned servant." },
    { name: "Philosopher's Stone", type: "Item", rarity: "Mythical", description: "Transmutes and prolongs life." },
    { name: "Enchanted Sealing Scroll", type: "Item", rarity: "Rare", description: "Allows sealing spirits and techniques." },
    { name: "Ring of Shadows", type: "Item", rarity: "Legendary", description: "Makes wearer partially invisible." },
    { name: "Spirit Beads", type: "Item", rarity: "Ultra Rare", description: "Channel and seal spiritual energy." },
    { name: "Phoenix Feather", type: "Item", rarity: "Legendary", description: "Can revive wearer once." },
    { name: "Time Sandglass", type: "Item", rarity: "Mythical", description: "Rewinds seconds in time." },
    { name: "Orb of Chaos", type: "Item", rarity: "Divine", description: "Manipulates entropy and chance in areas." },
    { name: "Sealing Blade", type: "Item", rarity: "Mythical", description: "Permanently seals abilities and beings." },
    { name: "Mana Crystal", type: "Item", rarity: "Common", description: "Basic source of magical energy." },
    { name: "Enchanted Armor", type: "Item", rarity: "Ultra Rare", description: "Protection against magical attacks." },
    { name: "Demon Horn", type: "Item", rarity: "Rare", description: "Boosts power at cost of humanity." },
    { name: "Sacred Talisman", type: "Item", rarity: "Divine", description: "Protects against curses and corruption." },
    { name: "Blackened Mirror", type: "Item", rarity: "Rare", description: "Reflects and returns curses." },
    { name: "Phantom Lantern", type: "Item", rarity: "Common", description: "Reveals nearby ghostly presences." },
    { name: "Starforged Armor", type: "Item", rarity: "Divine", description: "Armor forged with celestial metal." },
    { name: "Soulchain Collar", type: "Item", rarity: "Rare", description: "Connects destinies and shares damage." },
    { name: "Mystic Cloak", type: "Item", rarity: "Rare", description: "Grants high magical resistance." },
    { name: "Elixir of Giants", type: "Item", rarity: "Ultra Rare", description: "Temporarily increases size and strength." },
    { name: "Mirror of Memories", type: "Item", rarity: "Rare", description: "Extracts and shows ancient memories." },
    { name: "Void Anchor", type: "Item", rarity: "Ultra Rare", description: "Fixes a point in the void." },
    { name: "Cursed Sword", type: "Item", rarity: "Mythical", description: "Weapon with will and curse." },
    { name: "Phantom Chest (Mimic)", type: "Item", rarity: "Rare", description: "Living chest that deceives thieves." },
    { name: "Alicorn Horn", type: "Item", rarity: "Ultra Rare", description: "Pure and almost instant healing." },
    { name: "Grim Reaper Scythe", type: "Item", rarity: "Legendary", description: "Weapon that claims and manipulates souls." },
    { name: "Celestial Map", type: "Item", rarity: "Mythical", description: "Locates portals and astral paths." },
    { name: "Runic Bracelet", type: "Item", rarity: "Rare", description: "Enhances spells and magical resistance." },
    { name: "Soul Gem", type: "Item", rarity: "Ultra Rare", description: "Stores life energy for reuse." },
    { name: "Divine Relic", type: "Item", rarity: "Divine", description: "Object with concentrated celestial power." },
    { name: "Screwdriver", type: "Item", rarity: "Common", description: "Simple tool for screws." },
    { name: "Knife", type: "Item", rarity: "Common", description: "Basic cutting blade." },
    { name: "Hammer", type: "Item", rarity: "Common", description: "Useful for hitting nails." },
    { name: "Wrench", type: "Item", rarity: "Common", description: "Adjusts bolts and nuts." },
    { name: "Nail", type: "Item", rarity: "Common", description: "Small metal spike." },
    { name: "Screw", type: "Item", rarity: "Common", description: "Threaded fastener for construction." },
    { name: "Rope", type: "Item", rarity: "Common", description: "Sturdy cord for tying things." },
    { name: "Flashlight", type: "Item", rarity: "Common", description: "Portable light source." },
    { name: "Backpack", type: "Item", rarity: "Common", description: "Carry items easily." },
    { name: "Bottle of Water", type: "Item", rarity: "Common", description: "Hydration on the go." },
    { name: "Bandage", type: "Item", rarity: "Common", description: "Basic first aid for cuts." },
    { name: "Smartphone", type: "Item", rarity: "Common", description: "Portable communication device." },
    { name: "Laptop", type: "Item", rarity: "Common", description: "Portable computer." },
    { name: "Toothbrush", type: "Item", rarity: "Common", description: "Basic dental hygiene." },
    { name: "Coffee Mug", type: "Item", rarity: "Common", description: "Container for hot drinks." },
    { name: "Motorcycle", type: "Item", rarity: "Rare", description: "Two-wheeled vehicle for fast travel." },
    { name: "Street Bike (Yamaha R1)", type: "Item", rarity: "Ultra Rare", description: "High-performance sport bike." },
    { name: "Classic Scooter", type: "Item", rarity: "Common", description: "Small city scooter." },
    { name: "Electric Bicycle", type: "Item", rarity: "Common", description: "Pedal assist urban bike." }
  ],

  powers: [
    { name: "One For All", type: "Power", rarity: "Divine", description: "Accumulated power passed through generations." },
    { name: "All For One", type: "Power", rarity: "Divine", description: "Steal and use multiple abilities." },
    { name: "Explosion Quirk", type: "Power", rarity: "Rare", description: "Generate controlled body explosions." },
    { name: "Erasure Quirk", type: "Power", rarity: "Ultra Rare", description: "Temporarily nullify others' powers." },
    { name: "Gum-Gum Fruit (Gomu)", type: "Power", rarity: "Legendary", description: "Elastic body, extended attacks." },
    { name: "Gura Gura no Mi", type: "Power", rarity: "Mythical", description: "Generate earthquakes and seismic destruction." },
    { name: "Yami Fruit (Dark)", type: "Power", rarity: "Mythical", description: "Control darkness and gravity." },
    { name: "Flame Manipulation", type: "Power", rarity: "Common", description: "Control and project fire." },
    { name: "Ice Manipulation", type: "Power", rarity: "Rare", description: "Create and shape ice precisely." },
    { name: "Water Manipulation", type: "Power", rarity: "Common", description: "Control water and currents." },
    { name: "Earth Manipulation", type: "Power", rarity: "Common", description: "Move and shape earth and rock." },
    { name: "Lightning Manipulation", type: "Power", rarity: "Rare", description: "Generate and launch powerful lightning." },
    { name: "Gravity Manipulation", type: "Power", rarity: "Ultra Rare", description: "Modify gravity in areas." },
    { name: "Time Manipulation", type: "Power", rarity: "Divine", description: "Alter temporal flow around you." },
    { name: "Space Manipulation", type: "Power", rarity: "Divine", description: "Bend space and create rifts." },
    { name: "Telekinesis", type: "Power", rarity: "Rare", description: "Move objects with mind." },
    { name: "Telepathy", type: "Power", rarity: "Rare", description: "Communicate and read minds." },
    { name: "Reality Warping", type: "Power", rarity: "Divine", description: "Rewrite minor reality rules." },
    { name: "Soul Manipulation", type: "Power", rarity: "Mythical", description: "Control, extract, or modify souls." },
    { name: "Death Manipulation", type: "Power", rarity: "Mythical", description: "Invoke or delay death." },
    { name: "Healing Factor", type: "Power", rarity: "Rare", description: "Accelerated healing of wounds." },
    { name: "Regeneration", type: "Power", rarity: "Ultra Rare", description: "Massive tissue regrowth." },
    { name: "Shapeshifting", type: "Power", rarity: "Rare", description: "Change appearance and body form." },
    { name: "Size Manipulation", type: "Power", rarity: "Rare", description: "Alter size at will." },
    { name: "Clone Creation", type: "Power", rarity: "Common", description: "Generate temporary duplicates." },
    { name: "Energy Beam", type: "Power", rarity: "Common", description: "Concentrated offensive energy rays." },
    { name: "Blood Manipulation", type: "Power", rarity: "Ultra Rare", description: "Control own or others' blood." },
    { name: "Shadow Manipulation", type: "Power", rarity: "Legendary", description: "Use shadows as weapons and barriers." },
    { name: "Magnetism Control", type: "Power", rarity: "Rare", description: "Manipulate magnetic fields and metals." },
    { name: "Emotion Manipulation", type: "Power", rarity: "Mythical", description: "Change emotions of crowds." },
    { name: "Concept Manipulation: Decay", type: "Power", rarity: "Divine", description: "Matter decomposes on contact." },
    { name: "Probability Manipulation", type: "Power", rarity: "Mythical", description: "Alter luck and random outcomes." },
    { name: "Puppet Mastery", type: "Power", rarity: "Rare", description: "Control bodies or dolls remotely." },
    { name: "Memory Erasure", type: "Power", rarity: "Ultra Rare", description: "Erase selective memories at will." },
    { name: "Mind Control", type: "Power", rarity: "Legendary", description: "Mental domination over individuals." },
    { name: "Particle Manipulation", type: "Power", rarity: "Ultra Rare", description: "Control subatomic particles." },
    { name: "Sound Manipulation", type: "Power", rarity: "Rare", description: "Vibrations that damage or alter." },
    { name: "Plant Manipulation", type: "Power", rarity: "Common", description: "Control over flora and roots." },
    { name: "Animal Communication", type: "Power", rarity: "Common", description: "Talk to and command animals." },
    { name: "Portal Creation", type: "Power", rarity: "Ultra Rare", description: "Open instant portals between points." },
    { name: "Energy Absorption", type: "Power", rarity: "Legendary", description: "Absorb energy and reuse it." },
    { name: "Aura Manifestation", type: "Power", rarity: "Rare", description: "Materialize energy offensively." },
    { name: "Psychometry", type: "Power", rarity: "Rare", description: "Read object history by touch." },
    { name: "Absolute Zero", type: "Power", rarity: "Divine", description: "Freeze reality almost entirely." },
    { name: "Titan Shifting: Attack Titan", type: "Power", rarity: "Legendary", description: "Titan transformation with combative ferocity." },
    { name: "Titan Shifting: Founding Titan", type: "Power", rarity: "Divine", description: "Control other titans and memories." },
    { name: "Titan Shifting: Colossal Titan", type: "Power", rarity: "Mythical", description: "Transformation causing massive destruction." },
    { name: "Haki: Armament", type: "Power", rarity: "Rare", description: "Hard armor-like projection of will (One Piece)." },
    { name: "Haki: Observation", type: "Power", rarity: "Ultra Rare", description: "Heightened perception and precognition (One Piece)." },
    { name: "Limitless (Gojo)", type: "Power", rarity: "Limitless", description: "Infinity-based spatial control (Gojo Satoru)." },
    { name: "Transcendent Will", type: "Power", rarity: "Transcendental", description: "Power that bends the rules of fate." },
    { name: "Primordial Force", type: "Power", rarity: "Primordial", description: "Ancient energy predating gods." },
    { name: "Unbounded Essence", type: "Power", rarity: "Unbounded", description: "Beyond-limit force with unpredictable effects." }
  ]
};

    // --- UTILITIES ---
    function normalizeRarity(raw){
      if(!raw) return 'Common';
      const s = String(raw).toLowerCase().replace(/[_\-]+/g,' ').replace(/\s+/g,' ').trim();
      // canonicalize to display form (cover custom names used in DB)
      if(s.includes('unbounded')) return 'Unbounded';
      if(s.includes('limitless')) return 'Limitless';
      if(s.includes('transcend')) return 'Transcendental';
      if(s.includes('primordial')) return 'Primordial';
      if(s.includes('divine')) return 'Divine';
      if(s.includes('myth')) return 'Mythical';
      if(s.includes('legend')) return 'Legendary';
      if(s.includes('ultra')) return 'Ultra Rare';
      if(s.includes('rare')) return 'Rare';
      if(s.includes('garbage')) return 'Garbage';
      return 'Common';
    }

    function pickRarity(){
      // build cumulative distribution from rarityChances keys in a stable order
      const entries = Object.entries(rarityChances).map(([k,v])=>[k, Number(v||0)]);
      const total = entries.reduce((acc,[,w])=>acc+w,0) || 1;
      let r = Math.random() * total; let cum = 0;
      for(const [name,w] of entries){ cum += w; if(r <= cum) return name; }
      // fallback to the most common (last) entry
      return entries.length ? entries[entries.length-1][0] : 'Common';
    }

    // normalize database once on load -> produce pools per category and rarity for super-fast selection
    const pools = {}; // pools[category][rarity] = []
    function buildPools(){
      for(const cat of Object.keys(rawData)){
        pools[cat] = {};
        for(const r of rarityOrder) pools[cat][r] = [];
        const arr = rawData[cat] || [];
        for(const it of arr){
          const r = normalizeRarity(it.rarity);
          // We'll store the normalized rarity too
          const copy = Object.assign({}, it, { rarity: r });
          pools[cat][r].push(copy);
        }
      }
    }

    // try to find an item of selected rarity; if none, search near rarities
    function findItem(category, rarity){
      const catPools = pools[category] || null;
      if(!catPools) return null;
      if(Array.isArray(catPools[rarity]) && catPools[rarity].length > 0) return randomFrom(catPools[rarity]);
      const idx = rarityOrder.indexOf(rarity);
      if(idx === -1){
        // unknown rarity, try any
        const all = [].concat(...Object.values(catPools).filter(Boolean));
        return all.length ? randomFrom(all) : null;
      }
      // search nearby rarities: step 1..N, check both directions safely
      for(let d=1; d<rarityOrder.length; d++){
        const upIdx = idx - d; const downIdx = idx + d;
        if(upIdx >= 0){ const up = rarityOrder[upIdx]; if((catPools[up]||[]).length>0) return randomFrom(catPools[up]); }
        if(downIdx < rarityOrder.length){ const down = rarityOrder[downIdx]; if((catPools[down]||[]).length>0) return randomFrom(catPools[down]); }
      }
      // fallback any item
      const all = [].concat(...Object.values(catPools).filter(Boolean));
      return all.length ? randomFrom(all) : null;
    }

    function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    // --- UI hooks ---
    let currentCategory = 'skills';
    const cardEl = document.getElementById('gachaCard');
    const rollBtn = document.getElementById('rollButton');
    const infoBox = document.getElementById('infoBox');
    const infoContent = document.getElementById('infoContent');
    const nameEl = cardEl.querySelector('.name');
    const typeEl = cardEl.querySelector('.type');
    const backDesc = document.getElementById('backDesc');
    const rarityBadge = document.getElementById('rarityBadge');
    const glowEl = document.getElementById('glowEl');
    const catLabel = document.getElementById('currentCategoryLabel');

    function renderProbabilities(){
      const container = document.getElementById('probabilities');
      const entries = Object.entries(rarityChances).map(([k,v])=>({rarity:k,weight:Number(v)||0}));
      const total = entries.reduce((s,e)=>s+e.weight,0) || 1; entries.sort((a,b)=>b.weight-a.weight);
      container.innerHTML = '<strong>Rarity chances</strong>';
      for(const e of entries){
        const pct = ((e.weight/total)*100).toFixed(1);
        const row = document.createElement('div'); row.className='prob-row';
        const n = document.createElement('div'); n.textContent = e.rarity; n.style.color='#fff';
        const v = document.createElement('div'); v.textContent = pct+'%'; v.style.color='var(--muted)';
        row.appendChild(n); row.appendChild(v); container.appendChild(row);
      }
    }

    // --- FX: lightweight confetti/particles ---
  const fxCanvas = document.getElementById('fx-canvas');
  // guard: canvas or 2d context may be unavailable in some environments
  const ctx = (fxCanvas && fxCanvas.getContext) ? fxCanvas.getContext('2d') : null;
    let particles = [];
  function resizeCanvas(){ if(!fxCanvas || !ctx) return; fxCanvas.width = innerWidth * devicePixelRatio; fxCanvas.height = innerHeight * devicePixelRatio; fxCanvas.style.width = innerWidth+'px'; fxCanvas.style.height = innerHeight+'px'; ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0); }
    window.addEventListener('resize', resizeCanvas);

    function spawnParticles(x,y,color,amount=40){
      for(let i=0;i<amount;i++){
        particles.push({
          x, y,
          vx:(Math.random()-0.5)*8,
          vy:(Math.random()-0.9)*10 - 2,
          life:Math.random()*70+40,
          size:Math.random()*5+2,
          color,
        });
      }
    }

    function tickParticles(){
      if(!ctx || !fxCanvas) return;
      ctx.clearRect(0,0,fxCanvas.width,fxCanvas.height);
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.vy += 0.24; p.x += p.vx; p.y += p.vy; p.life -= 1;
        ctx.globalAlpha = Math.max(0, p.life/100);
        ctx.beginPath(); ctx.fillStyle = p.color; ctx.arc(p.x, p.y, p.size,0,Math.PI*2); ctx.fill();
        if(p.life<=0){ particles.splice(i,1); }
      }
      if(particles.length>0) requestAnimationFrame(tickParticles);
    }

    function showEffectsForRarity(rarity){
      const rect = cardEl.getBoundingClientRect();
      const cx = rect.left + rect.width/2; const cy = rect.top + rect.height/2;
      const colorMap = {
        'Common':'#9aa0a6','Rare':'#3b82f6','Ultra Rare':'#7c3aed','Legendary':'#f59e0b','Mythical':'#ec4899','Divine':'#ff5a3c'
      };
      const col = colorMap[rarity] || '#fff';
      // glow color
      glowEl.style.background = `radial-gradient(circle at 50% 40%, ${col}20, transparent 40%)`;
      if(['Legendary','Mythical','Divine'].includes(rarity)){
        // big confetti + audio beep
        spawnParticles(cx,cy,col,120);
        if(particles.length>0) requestAnimationFrame(tickParticles);
        playBeep(320,0.08,0.12);
      } else if(rarity === 'Ultra Rare'){
        spawnParticles(cx,cy,col,60); if(particles.length>0) requestAnimationFrame(tickParticles); playBeep(440,0.05,0.06);
      } else if(rarity === 'Rare'){
        spawnParticles(cx,cy,col,22); if(particles.length>0) requestAnimationFrame(tickParticles); playBeep(640,0.02,0.03);
      }
      // show glow briefly
      cardEl.classList.add('show-glow'); setTimeout(()=>cardEl.classList.remove('show-glow'), 1200);
    }

    function playBeep(freq=440,dur=0.06,volume=0.05){
      try{
        const ac = new (window.AudioContext || window.webkitAudioContext)();
        const o = ac.createOscillator(); const g = ac.createGain();
        o.type='sine'; o.frequency.value = freq; g.gain.value = volume;
        o.connect(g); g.connect(ac.destination);
        o.start(); o.stop(ac.currentTime + dur);
        setTimeout(()=>{ ac.close(); }, (dur+0.05)*1000);
      }catch(e){/*audio not available*/}
    }

    // --- Rolling logic ---
    function rollOnce(){
      rollBtn.disabled = true; cardEl.classList.add('rolling'); cardEl.setAttribute('aria-pressed','true');

      // small UX: quick random flash names while 'rolling'
      const pool = rawData[currentCategory] || [];
      let flashInterval = setInterval(()=>{
        const rnd = pool.length ? pool[Math.floor(Math.random()*pool.length)] : {name:'...'};
        nameEl.textContent = rnd.name || '...'; typeEl.textContent = rnd.type || '';
      },80);

      setTimeout(()=>{
        clearInterval(flashInterval);
        // pick rarity by weights
        const chosenRarity = pickRarity();
        const item = findItem(currentCategory, chosenRarity);
        // display
        if(item){
          const cssClass = 'rarity-' + chosenRarity.toLowerCase().replace(/\s+/g,'-');
          // apply badge
          rarityBadge.style.display='inline-block'; rarityBadge.textContent = chosenRarity;
          rarityBadge.style.background = '#fff'; rarityBadge.style.color='#07080a';
          rarityBadge.style.boxShadow = `0 6px 24px ${chosenRarity==='Divine'?'rgba(255,90,60,0.12)': 'rgba(0,0,0,0.2)'}`;

          nameEl.textContent = item.name;
          typeEl.textContent = item.type + ' — ' + item.rarity;
          backDesc.textContent = item.description || '';
          infoContent.innerHTML = `<strong>${item.name}</strong> <br><small style='color:var(--muted)'>${item.type} — ${item.rarity}</small><p style='margin-top:8px;color:var(--muted)'>${item.description || ''}</p>`;

          // fx
          showEffectsForRarity(item.rarity);
            // save to history (last 3 per category)
            saveToHistory(currentCategory, { name: item.name, type: item.type, rarity: item.rarity });
            renderHistory(currentCategory);
        } else {
          nameEl.textContent = '—'; typeEl.textContent='No result'; infoContent.textContent = 'No items found in this pool.';
        }

        // end animation
        cardEl.classList.remove('rolling'); rollBtn.disabled = false; cardEl.setAttribute('aria-pressed','false');
      }, 900);
    }

    // event bindings
    document.querySelectorAll('.menu button').forEach(b=>{
      b.addEventListener('click', ()=>{
        document.querySelectorAll('.menu button').forEach(x=>x.classList.remove('active'));
  b.classList.add('active'); currentCategory = b.dataset.cat; catLabel.textContent = currentCategory; nameEl.textContent = 'Click to roll'; typeEl.textContent = 'Category: '+currentCategory; rarityBadge.style.display='none'; renderHistory(currentCategory);
      });
    });

    rollBtn.addEventListener('click', rollOnce);
    cardEl.addEventListener('click', () => { if(!rollBtn.disabled) rollOnce(); });
    cardEl.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); if(!rollBtn.disabled) rollOnce(); }});

    document.getElementById('copyBtn').addEventListener('click', ()=>{
      const text = infoContent.innerText || 'No result yet.';
      navigator.clipboard?.writeText(text).then(()=>{
        const prev = document.getElementById('copyBtn').textContent; document.getElementById('copyBtn').textContent = 'Copied!';
        setTimeout(()=>document.getElementById('copyBtn').textContent = prev,900);
      }).catch(()=>{ alert('Clipboard not available'); });
    });

    // init
    buildPools(); resizeCanvas(); renderProbabilities();
      // HISTORY: localStorage-backed last 3 per category
      const HISTORY_KEY = 'gacha_history_v1';
      function loadHistory(){
        try{ const raw = localStorage.getItem(HISTORY_KEY); return raw ? JSON.parse(raw) : {}; }catch(e){ return {}; }
      }
      function saveHistory(obj){ try{ localStorage.setItem(HISTORY_KEY, JSON.stringify(obj)); }catch(e){}
      }
      function saveToHistory(category, item){
        if(!category || !item) return;
        const h = loadHistory(); if(!h[category]) h[category]=[];
        // remove duplicates of same name (keep newest)
        h[category] = h[category].filter(x=>x.name !== item.name);
        h[category].unshift(item); // newest first
    if(h[category].length > 5) h[category] = h[category].slice(0,5);
        saveHistory(h);
      }
      function renderHistory(category){
        const listEl = document.getElementById('historyList'); if(!listEl) return;
        const h = loadHistory(); const arr = h[category] || [];
        listEl.innerHTML = '';
        if(arr.length===0){ listEl.innerHTML = '<div style="color:var(--muted)">No history yet for this category.</div>'; return; }
        for(const it of arr){
          const d = document.createElement('div'); d.className='history-item';
          d.innerHTML = `<div style="font-weight:700;color:var(--accent)">${it.name}</div><div style="font-size:12px;color:var(--muted)">${it.type} — ${it.rarity}</div>`;
          listEl.appendChild(d);
        }
      }

      // render current category history on load
      renderHistory(currentCategory);

      // HELP modal behavior
      const helpModal = document.getElementById('helpModal');
      const helpOverlay = document.getElementById('helpOverlay');
      const helpContent = document.getElementById('helpContent');
      const helpResults = document.getElementById('helpResults');
      document.getElementById('helpBtn').addEventListener('click', ()=>{
        helpModal.style.display='block'; helpModal.setAttribute('aria-hidden','false'); helpResults.innerHTML='';
      });
      function closeHelp(){ helpModal.style.display='none'; helpModal.setAttribute('aria-hidden','true'); helpResults.innerHTML=''; }
      document.getElementById('helpClose').addEventListener('click', closeHelp);
      helpOverlay.addEventListener('click', closeHelp);

      document.getElementById('showAllBtn').addEventListener('click', ()=>{
        // render all categories/items
        helpResults.innerHTML = '';
        for(const cat of Object.keys(rawData)){
          const heading = document.createElement('div'); heading.style.marginTop='8px'; heading.innerHTML = `<strong style="color:var(--accent)">${cat}</strong>`;
          helpResults.appendChild(heading);
          const ul = document.createElement('div'); ul.style.display='flex'; ul.style.flexWrap='wrap'; ul.style.gap='8px'; ul.style.marginTop='6px';
          for(const it of rawData[cat]){
            const pill = document.createElement('div'); pill.style.padding='6px 8px'; pill.style.borderRadius='8px'; pill.style.background='rgba(255,255,255,0.02)'; pill.style.border='1px solid rgba(255,255,255,0.02)'; pill.style.minWidth='120px'; pill.style.fontSize='13px';
            pill.innerHTML = `<div style="font-weight:700;color:var(--accent)">${it.name}</div><div style="font-size:12px;color:var(--muted)">${it.type} — ${normalizeRarity(it.rarity)}</div>`;
            ul.appendChild(pill);
          }
          helpResults.appendChild(ul);
        }
      });

      document.getElementById('copyAllBtn').addEventListener('click', ()=>{
        // copy all names across categories
        const allNames = [];
        for(const cat of Object.keys(rawData)) for(const it of rawData[cat]) allNames.push(it.name);
        const txt = allNames.join('\n');
        navigator.clipboard?.writeText(txt).then(()=>{
          const prev = document.getElementById('copyAllBtn').textContent; document.getElementById('copyAllBtn').textContent = 'Copied!';
          setTimeout(()=>document.getElementById('copyAllBtn').textContent = prev,900);
        }).catch(()=>{ alert('Clipboard not available'); });
      });

    // If you plan to paste a HUGE DB, the buildPools() step still runs fast — we simply normalize and index once at startup.

  </script>
</body>
</html>







